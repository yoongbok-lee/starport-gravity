import { sleep } from '@cosmjs/utils';
import test from 'ava';
import { MsgTransfer } from '../codec/ibc/applications/transfer/v1/tx';
import { buildCreateClientArgs, prepareConnectionHandshake } from './ibcclient';
import { Link } from './link';
import { ics20, randomAddress, setup, simapp, TestLogger, wasmd, } from './testutils';
import { buildClientState, buildConsensusState, parseAcksFromLogs, parsePacketsFromLogs, } from './utils';
test.serial('create simapp client on wasmd', async (t) => {
    const logger = new TestLogger();
    const [src, dest] = await setup(logger);
    const preClients = await dest.query.ibc.client.allStates();
    const preLen = preClients.clientStates.length;
    const header = await src.latestHeader();
    const conState = buildConsensusState(header);
    const cliState = buildClientState(await src.getChainId(), 1000, 500, src.revisionHeight(header.height));
    const res = await dest.createTendermintClient(cliState, conState);
    t.assert(res.clientId.startsWith('07-tendermint-'));
    await dest.waitOneBlock();
    const postClients = await dest.query.ibc.client.allStates();
    t.is(postClients.clientStates.length, preLen + 1);
});
test.serial('create and update wasmd client on simapp', async (t) => {
    const [src, dest] = await setup();
    const header = await src.latestHeader();
    const conState = buildConsensusState(header);
    const cliState = buildClientState(await src.getChainId(), 1000, 500, src.revisionHeight(header.height));
    const { clientId } = await dest.createTendermintClient(cliState, conState);
    const state = await dest.query.ibc.client.stateTm(clientId);
    // console.error(state);
    // TODO: check more details?
    t.is(state.latestHeight?.revisionHeight.toNumber(), header.height);
    t.deepEqual(state.chainId, await src.getChainId());
    // wait for a few blocks, then try
    await sleep(1000);
    const newHeader = await src.buildHeader(header.height);
    const newHeight = newHeader.signedHeader?.header?.height;
    t.not(newHeight?.toNumber(), header.height);
    await dest.updateTendermintClient(clientId, newHeader);
    // any other checks?
    const upstate = await dest.query.ibc.client.stateTm(clientId);
    t.assert(sameLong(upstate.latestHeight?.revisionHeight, newHeight));
});
// handles both as optional fields, does Long.equal to ignore signed/unsigned difference
function sameLong(a, b) {
    if (a === undefined) {
        return false;
    }
    if (b === undefined) {
        return false;
    }
    return a.equals(b);
}
// measured in seconds
// Note: client parameter is checked against the actual keeper - must use real values from genesis.json
const genesisUnbondingTime = 1814400;
// make 2 clients, and try to establish a connection
test.serial('perform connection handshake', async (t) => {
    const [src, dest] = await setup();
    // client on dest -> src
    const args = await buildCreateClientArgs(src, genesisUnbondingTime, 5000);
    const { clientId: destClientId } = await dest.createTendermintClient(args.clientState, args.consensusState);
    t.assert(destClientId.startsWith('07-tendermint-'));
    // client on src -> dest
    const args2 = await buildCreateClientArgs(dest, genesisUnbondingTime, 5000);
    const { clientId: srcClientId } = await src.createTendermintClient(args2.clientState, args2.consensusState);
    t.assert(srcClientId.startsWith('07-tendermint-'));
    // connectionInit on src
    const { connectionId: srcConnId } = await src.connOpenInit(srcClientId, destClientId);
    t.assert(srcConnId.startsWith('connection-'), srcConnId);
    // connectionTry on dest
    const proof = await prepareConnectionHandshake(src, dest, srcClientId, destClientId, srcConnId);
    // now post and hope it is accepted
    const { connectionId: destConnId } = await dest.connOpenTry(destClientId, proof);
    t.assert(destConnId.startsWith('connection-'), destConnId);
    // connectionAck on src
    const proofAck = await prepareConnectionHandshake(dest, src, destClientId, srcClientId, destConnId);
    await src.connOpenAck(srcConnId, proofAck);
    // connectionConfirm on dest
    const proofConfirm = await prepareConnectionHandshake(src, dest, srcClientId, destClientId, srcConnId);
    await dest.connOpenConfirm(destConnId, proofConfirm);
});
test.serial('transfer message and send packets', async (t) => {
    const logger = new TestLogger();
    // set up ics20 channel
    const [nodeA, nodeB] = await setup();
    const link = await Link.createWithNewConnections(nodeA, nodeB, logger);
    const channels = await link.createChannel('A', ics20.srcPortId, ics20.destPortId, ics20.ordering, ics20.version);
    t.is(channels.src.portId, ics20.srcPortId);
    // make an account on remote chain, and check it is empty
    const recipient = randomAddress(wasmd.prefix);
    const preBalance = await nodeB.query.bank.unverified.allBalances(recipient);
    t.is(preBalance.length, 0);
    // submit a transfer message
    const destHeight = await nodeB.timeoutHeight(500); // valid for 500 blocks
    const token = { amount: '12345', denom: simapp.denomFee };
    const transferResult = await nodeA.transferTokens(channels.src.portId, channels.src.channelId, token, recipient, destHeight);
    const packets = parsePacketsFromLogs(transferResult.logs);
    t.is(packets.length, 1);
    const packet = packets[0];
    // base the proof sequence on prepareChannelHandshake
    // update client on dest
    await nodeA.waitOneBlock();
    const headerHeight = await nodeB.doUpdateClient(link.endB.clientID, nodeA);
    const proof = await nodeA.getPacketProof(packet, headerHeight);
    const relayResult = await nodeB.receivePacket(packet, proof, headerHeight);
    // query balance of recipient (should be "12345" or some odd hash...)
    const postBalance = await nodeB.query.bank.unverified.allBalances(recipient);
    t.is(postBalance.length, 1);
    const recvCoin = postBalance[0];
    t.is(recvCoin.amount, '12345');
    t.assert(recvCoin.denom.startsWith('ibc/'), recvCoin.denom);
    // get the acknowledgement from the receivePacket tx
    const acks = parseAcksFromLogs(relayResult.logs);
    t.is(acks.length, 1);
    const ack = acks[0];
    // get an ack proof and return to node A
    await nodeB.waitOneBlock();
    const ackHeaderHeight = await nodeA.doUpdateClient(link.endA.clientID, nodeB);
    const ackProof = await nodeB.getAckProof(ack, ackHeaderHeight);
    await nodeA.acknowledgePacket(ack, ackProof, ackHeaderHeight);
    // Do we need to check the result? or just see the tx succeeded?
});
test.serial('tests parsing with multi-message', async (t) => {
    const logger = new TestLogger();
    // set up ics20 channel
    const [nodeA, nodeB] = await setup(logger);
    const link = await Link.createWithNewConnections(nodeA, nodeB, logger);
    const channels = await link.createChannel('A', ics20.srcPortId, ics20.destPortId, ics20.ordering, ics20.version);
    // make an account on remote chain for testing
    const destAddr = randomAddress(wasmd.prefix);
    const srcAddr = randomAddress(simapp.prefix);
    // submit a send message - no events
    const { logs: sendLogs } = await nodeA.sendTokens(srcAddr, [
        { amount: '5000', denom: simapp.denomFee },
    ]);
    t.assert(logger.verbose.calledWithMatch(/Send tokens to/), logger.verbose.callCount.toString());
    t.assert(logger.debug.calledWithMatch(/Send tokens:/), logger.debug.callCount.toString());
    const sendPackets = parsePacketsFromLogs(sendLogs);
    t.is(sendPackets.length, 0);
    const sendAcks = parseAcksFromLogs(sendLogs);
    t.is(sendAcks.length, 0);
    // submit 2 transfer messages
    const timeoutHeight = await nodeB.timeoutHeight(500);
    const msg = {
        typeUrl: '/ibc.applications.transfer.v1.MsgTransfer',
        value: MsgTransfer.fromPartial({
            sourcePort: channels.src.portId,
            sourceChannel: channels.src.channelId,
            sender: nodeA.senderAddress,
            token: { amount: '6000', denom: simapp.denomFee },
            receiver: destAddr,
            timeoutHeight,
        }),
    };
    const msg2 = {
        typeUrl: '/ibc.applications.transfer.v1.MsgTransfer',
        value: MsgTransfer.fromPartial({
            sourcePort: channels.src.portId,
            sourceChannel: channels.src.channelId,
            sender: nodeA.senderAddress,
            token: { amount: '9000', denom: simapp.denomFee },
            receiver: destAddr,
            timeoutHeight,
        }),
    };
    const { logs: multiLog } = await nodeA.sendMultiMsg([msg, msg2], nodeA.fees.updateClient);
    const multiPackets = parsePacketsFromLogs(multiLog);
    t.is(multiPackets.length, 2);
    // no acks here
    const multiAcks = parseAcksFromLogs(multiLog);
    t.is(multiAcks.length, 0);
    // post them to the other side
    await nodeA.waitOneBlock();
    const headerHeight = await nodeB.doUpdateClient(link.endB.clientID, nodeA);
    const proofs = await Promise.all(multiPackets.map((packet) => nodeA.getPacketProof(packet, headerHeight)));
    const { logs: relayLog } = await nodeB.receivePackets(multiPackets, proofs, headerHeight);
    // no recv packets here
    const relayPackets = parsePacketsFromLogs(relayLog);
    t.is(relayPackets.length, 0);
    // but we got 2 acks
    const relayAcks = parseAcksFromLogs(relayLog);
    t.is(relayAcks.length, 2);
    // relay them together
    await nodeB.waitOneBlock();
    const ackHeaderHeight = await nodeA.doUpdateClient(link.endA.clientID, nodeB);
    const ackProofs = await Promise.all(relayAcks.map((ack) => nodeB.getAckProof(ack, ackHeaderHeight)));
    await nodeA.acknowledgePackets(relayAcks, ackProofs, ackHeaderHeight);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWJjY2xpZW50LnNwZWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2liY2NsaWVudC5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdEMsT0FBTyxJQUFJLE1BQU0sS0FBSyxDQUFDO0FBRXZCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUV2RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDaEYsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUM5QixPQUFPLEVBQ0wsS0FBSyxFQUNMLGFBQWEsRUFDYixLQUFLLEVBQ0wsTUFBTSxFQUNOLFVBQVUsRUFDVixLQUFLLEdBQ04sTUFBTSxhQUFhLENBQUM7QUFDckIsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixtQkFBbUIsRUFDbkIsaUJBQWlCLEVBQ2pCLG9CQUFvQixHQUNyQixNQUFNLFNBQVMsQ0FBQztBQUVqQixJQUFJLENBQUMsTUFBTSxDQUFDLCtCQUErQixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRTtJQUN2RCxNQUFNLE1BQU0sR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO0lBQ2hDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsTUFBTSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFeEMsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDM0QsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUM7SUFFOUMsTUFBTSxNQUFNLEdBQUcsTUFBTSxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7SUFFeEMsTUFBTSxRQUFRLEdBQUcsbUJBQW1CLENB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